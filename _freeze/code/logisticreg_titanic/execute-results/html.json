{
  "hash": "a8dc2775685db4d2838c9b84694e060c",
  "result": {
    "markdown": "---\ntitle: \"Bayesian logistic regression for the Titanic data\"\nauthor: \"Mattias Villani\"\n---\n\n\n### Load packages\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mvtnorm)      # package with multivariate normal density\nlibrary(latex2exp)    # latex maths in plots\n```\n:::\n\n\n### Settings\n\n::: {.cell}\n\n```{.r .cell-code}\ntau <- 10             # Prior std beta~N(0,tau^2*I)\n```\n:::\n\n\n### Read data and set up prior\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(\"https://github.com/mattiasvillani/introbayes/raw/main/data/titanic.csv\", header=TRUE) \ny <- as.vector(df[,1])\nX <- df[,c(5, 4, 2)]\nX[, 2] <- 1*(X[,2] == \"female\")\nX[, 3] <- 1*(X[,3] == 1)\nX <- as.matrix(cbind(1,X))\np <- dim(X)[2]\nvarNames = c(\"intercept\", \"age\", \"sex\", \"firstclass\")\n\n# Setting up the prior\nmu <- as.vector(rep(0,p)) # Prior mean vector\nSigma <- tau^2*diag(p)\n```\n:::\n\n\n##### Coding up the log posterior function\n\n::: {.cell}\n\n```{.r .cell-code}\nLogPostLogistic <- function(betaVect, y, X, mu, Sigma){\n  p <- length(betaVect)\n  linPred <- X%*%betaVect\n  logLik <- sum( linPred*y - log(1 + exp(linPred)))\n  logPrior <- dmvnorm(betaVect, matrix(0,p,1), Sigma, log=TRUE)\n  return(logLik + logPrior)\n}\n```\n:::\n\n\n### Finding the mode and observed information using optim\n\n::: {.cell}\n\n```{.r .cell-code}\ninitVal <- as.vector(rep(0,p)); \nOptimResults<-optim(initVal, LogPostLogistic, gr=NULL, y, X, mu, Sigma,\n  method = c(\"BFGS\"), control=list(fnscale=-1), hessian=TRUE)\npostMode = OptimResults$par\npostCov = -solve(OptimResults$hessian) # inv(J) - Approx posterior covar matrix\npostStd <- sqrt(diag(postCov))         # Approximate stdev\n```\n:::\n\n\n### Plot the marginal posterior of $\\beta$\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,2))\nfor (j in 1:4){\n  gridVals = seq(postMode[j] - 3*postStd[j], postMode[j] + 3*postStd[j], \n                 length = 100)\n  plot(gridVals, dnorm(gridVals, mean = postMode[j], sd = postStd[j]), \n    xlab = TeX(sprintf(r'($\\beta_%d$)', j-1)), ylab= \"posterior density\", \n    type =\"l\", bty = \"n\", lwd = 2, col = \"cornflowerblue\", main =varNames[j])\n}\n```\n\n::: {.cell-output-display}\n![](logisticreg_titanic_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Plot the marginal posterior of the odds $\\exp(\\beta)$\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,2)) \nfor (j in 1:4){\n  gridVals = exp(seq(postMode[j] - 3*postStd[j], postMode[j] + 3*postStd[j], length = 100))\n  plot(gridVals, dlnorm(gridVals, meanlog = postMode[j], sdlog = postStd[j]), \n    xlab = TeX(sprintf(r'($\\exp(\\beta_%d$))', j-1)), ylab= \"posterior density\", type =\"l\", bty = \"n\", \n    lwd = 2, col = \"cornflowerblue\", main = varNames[j])\n}\n```\n\n::: {.cell-output-display}\n![](logisticreg_titanic_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::",
    "supporting": [
      "logisticreg_titanic_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}